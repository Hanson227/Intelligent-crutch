C51 COMPILER V9.60.0.0   MAIN                                                              08/01/2022 23:32:03 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\obj\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\code\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\code;..\user) DEBUG OB
                    -JECTEXTEND PRINT(.\main.lst) OBJECT(..\obj\main.obj)

line level    source

   1          /**
   2            ******************************************************************************
   3            * @file    main.c
   4            * @author  chen
   5            * @version V1.0
   6            * @date    2022-xx-xx
   7            * @brief   主函数
   8            *                      CPU: STC11L08XE
   9            *              晶振：22.1184MHZ
  10            *                  波特率：9600 bit/S
  11            ******************************************************************************
  12            */
  13          
  14          #include "config.h"
  15          
  16          uint8 idata nAsrStatus = 0;
  17          void MCU_init();
  18          void ProcessInt0(); //识别处理函数
  19          void delay(unsigned long uldata);
  20          void User_handle(uint8 dat);//用户执行操作函数
  21          void Delay200ms();
  22          void Led_test(void);//单片机工作指示
  23          uint8_t G0_flag = DISABLE; //运行标志，ENABLE:运行。DISABLE:禁止运行
  24          sbit LED = P4 ^ 2; //信号指示灯
  25          
  26          sbit SRD1 = P1 ^ 7;
  27          sbit SRD2 = P1 ^ 6;
  28          sbit SRD3 = P1 ^ 5;
  29          sbit SRD4 = P1 ^ 4;
  30          
  31          char P_cmd_arr[20] = {0};
  32          
  33          uint8 P_cmd_num = 100;
  34          
  35           /**
  36            * @brief  主函数      程序入口
  37            * @param  无
  38            * @retval 无
  39            */
  40          void  main(void)
  41          {
  42   1              char time_count = 0;
  43   1              uint8 idata nAsrRes;
  44   1              char cmd = 0;
  45   1              uint8 i = 0;
  46   1              P1M0 = 0xFF;
  47   1              P1M1 = 0x00;
  48   1              SRD1 = SRD2 = SRD3 = SRD4 = 0;
  49   1              Led_test();
  50   1              MCU_init();
  51   1              LD_Reset();
  52   1              UartIni(); /*串口初始化*/
  53   1              nAsrStatus = LD_ASR_NONE;               //      初始状态：没有在作ASR
  54   1              PrintCom("<G>我是小布，很高兴为您服务");
C51 COMPILER V9.60.0.0   MAIN                                                              08/01/2022 23:32:03 PAGE 2   

  55   1              while(1)
  56   1              {
  57   2      //              cmd = (char)UARTReceiveByte();
  58   2      //              
  59   2                      switch(RX_BUF[NUM_1])
  60   2                      {
  61   3                              case '1':
  62   3                                      memset(P_cmd_arr,0,20);
  63   3                                      memcpy(P_cmd_arr,"<G>前方斑马线",strlen("<G>前方斑马线"));
  64   3                                      break;
  65   3                              case '2':
  66   3                                      memset(P_cmd_arr,0,20);
  67   3                                      memcpy(P_cmd_arr,"<G>前方楼梯",strlen("<G>前方楼梯"));
  68   3                                      break;
  69   3                              case '3':
  70   3                                      memset(P_cmd_arr,0,20);
  71   3                                      memcpy(P_cmd_arr,"<G>前方有障碍物",strlen("<G>前方有障碍物"));
  72   3                                      break;
  73   3                              default:
  74   3                                      break;
  75   3                      }
  76   2                      switch(nAsrStatus)
  77   2                      {
  78   3                      case LD_ASR_RUNING:
  79   3                      case LD_ASR_ERROR:
  80   3                              break;
  81   3                      case LD_ASR_NONE:
  82   3                      {
  83   4                              nAsrStatus = LD_ASR_RUNING;
  84   4                              if (RunASR() == 0)      /*      启动一次ASR识别流程：ASR初始化，ASR添加关键词语，启动ASR运算*/
  85   4                              {
  86   5                                      nAsrStatus = LD_ASR_ERROR;
  87   5                              }
  88   4                              break;
  89   4                      }
  90   3                      case LD_ASR_FOUNDOK: /* 一次ASR识别流程结束，去取ASR识别结果*/
  91   3                      {
  92   4                              nAsrRes = LD_GetResult();               /*获取结果*/
  93   4                              User_handle(nAsrRes);//用户执行函数
  94   4                              nAsrStatus = LD_ASR_NONE;
  95   4                              break;
  96   4                      }
  97   3                      case LD_ASR_FOUNDZERO:
  98   3                      default:
  99   3                      {
 100   4                              nAsrStatus = LD_ASR_NONE;
 101   4                              break;
 102   4                      }
 103   3                      }
 104   2              }
 105   1      
 106   1      }
 107          
 108           /**
 109            * @brief  板载LED灯测试
 110            * @param  无
 111            * @retval 无
 112            */
 113          void Led_test(void)
 114          {
 115   1              LED = ~ LED;
 116   1              Delay200ms();
C51 COMPILER V9.60.0.0   MAIN                                                              08/01/2022 23:32:03 PAGE 3   

 117   1              LED = ~ LED;
 118   1              Delay200ms();
 119   1              LED = ~ LED;
 120   1              Delay200ms();
 121   1              LED = ~ LED;
 122   1              Delay200ms();
 123   1              LED = ~ LED;
 124   1              Delay200ms();
 125   1              LED = ~ LED;
 126   1      }
 127          
 128           /**
 129            * @brief  单片机初始化
 130            * @param  无
 131            * @retval 无
 132            */
 133          void MCU_init()
 134          {
 135   1              P0 = 0xff;
 136   1              P1 = 0x00;
 137   1              P2 = 0xff;
 138   1              P3 = 0xff;
 139   1              P4 = 0xff;
 140   1      
 141   1      
 142   1              AUXR &= 0x7F;           //定时器时钟12T模式
 143   1              TMOD |= 0x01;           //设置定时器模式
 144   1              TL0 = 0x00;             //设置定时初值
 145   1              TH0 = 0x28;             //设置定时初值
 146   1              TF0 = 0;                //清除TF0标志
 147   1              TR0 = 1;                //定时器0开始计时
 148   1              ET0 = 1;
 149   1      
 150   1              LD_MODE = 0;            //      设置MD管脚为低，并行模式读写
 151   1              IE0 = 1;
 152   1              EX0 = 1;
 153   1              EA = 1;
 154   1              WDT_CONTR = 0x3D;
 155   1      }
 156          
 157           /**
 158            * @brief  延时函数
 159            * @param  无
 160            * @retval 无
 161            */
 162          void Delay200us()               //@22.1184MHz
 163          {
 164   1              unsigned char i, j;
 165   1              _nop_();
 166   1              _nop_();
 167   1              i = 5;
 168   1              j = 73;
 169   1              do
 170   1              {
 171   2                      while (--j);
 172   2              }
 173   1              while (--i);
 174   1      }
 175          
 176           /**
 177            * @brief  延时函数
 178            * @param  uldata：单位200us
C51 COMPILER V9.60.0.0   MAIN                                                              08/01/2022 23:32:03 PAGE 4   

 179            * @retval 无
 180            */
 181          void  delay(unsigned long uldata)
 182          {
 183   1              unsigned int j  =  0;
 184   1              unsigned int g  =  0;
 185   1              while(uldata--)
 186   1                      Delay200us();
 187   1      }
 188          
 189           /**
 190            * @brief  延时函数
 191            * @param  无
 192            * @retval 无
 193            */
 194          void Delay200ms()               //@22.1184MHz
 195          {
 196   1              unsigned char i, j, k;
 197   1      
 198   1              i = 17;
 199   1              j = 208;
 200   1              k = 27;
 201   1              do
 202   1              {
 203   2                      do
 204   2                      {
 205   3                              while (--k);
 206   3                      }
 207   2                      while (--j);
 208   2              }
 209   1              while (--i);
 210   1      }
 211          
 212           /**
 213            * @brief  中断处理函数
 214            * @param  无
 215            * @retval 无
 216            */
 217          void ExtInt0Handler(void) interrupt 0
 218          {
 219   1              ProcessInt0();
 220   1      }
 221          
 222           /**
 223            * @brief  用户执行函数，识别成功后，执行动作可在此进行修改
 224            * @param  无
 225            * @retval 无
 226            */
 227          void    User_handle(uint8 dat)
 228          {
 229   1              switch(dat)
 230   1              {
 231   2              case CODE_1:            /*命令“”*/
 232   2                      SRD1 = 1;
 233   2                      PrintCom("<G>找小布有什么事吗\r\n");
 234   2                      break;
 235   2              case CODE_2:            /*命令“”*/
 236   2                      SRD1 = 0;
 237   2                      PrintCom("<G>在的\r\n");
 238   2                      break;
 239   2              case CODE_3:            /*命令“”*/
 240   2                      SRD2 = 1;
C51 COMPILER V9.60.0.0   MAIN                                                              08/01/2022 23:32:03 PAGE 5   

 241   2                      PrintCom("<G>我在\r\n");
 242   2                      break;
 243   2              case CODE_4:            /*命令“”*/
 244   2                      SRD2 = 0;
 245   2                      PrintCom("<G>小布在的\r\n");
 246   2                      break;
 247   2              case CODE_5:            /*命令“”*/
 248   2                      SRD3 = 1;
 249   2                      PrintCom("<G>现在是下午一点\r\n");
 250   2                      break;
 251   2              default:/*text.....*/
 252   2                      break;
 253   2              }
 254   1      }
 255          
 256           /**
 257            * @brief  定时器中断函数
 258            * @param  无
 259            * @retval 无
 260            */
 261          void tm0_isr() interrupt 1
 262          {
 263   1              TL0 = 0x00;             //设置定时初值,差不多40ms
 264   1              TH0 = 0x28;             //设置定时初值
 265   1              WDT_CONTR = 0x3D;
 266   1              P_cmd_num--;
 267   1              if(P_cmd_num==0)
 268   1              {
 269   2                      PrintCom(P_cmd_arr);
 270   2                      memset(P_cmd_arr,0,20);
 271   2                      P_cmd_num = 100;
 272   2              }
 273   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    605    ----
   CONSTANT SIZE    =    146    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     22      11
   IDATA SIZE       =      1       1
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
