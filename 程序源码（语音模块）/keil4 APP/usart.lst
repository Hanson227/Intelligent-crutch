C51 COMPILER V9.60.0.0   USART                                                             08/01/2022 23:31:28 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE USART
OBJECT MODULE PLACED IN ..\obj\usart.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\user\usart.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\code;..\user) DEBUG O
                    -BJECTEXTEND PRINT(.\usart.lst) OBJECT(..\obj\usart.obj)

line level    source

   1          #include "config.h"
   2          #define FOSC 22118400L      //System frequency
   3          uint32_t baud=9600;           //UART baudrate
   4          
   5          uint8_t RX_BUF[50];
   6          uint8_t NUM_1=0;
   7          uint8_t DAT = 0;
   8          
   9           /**
  10            * @brief  串口初始化,STC10L08XE 单片机串口初始化函数
  11            * @param  无
  12            * @retval 无
  13            */
  14          void UartIni(void)
  15          {
  16   1          SCON = 0x50;            //8-bit variable UART
  17   1          TMOD = 0x20;            //Set Timer1 as 8-bit auto reload mode
  18   1          TH1 = TL1 = -(FOSC/12/32/baud); //Set auto-reload vaule
  19   1          TR1 = 1;                //Timer1 start run
  20   1          ES = 1;                 //Enable UART interrupt
  21   1          EA = 1;                 //Open master interrupt switch
  22   1      }
  23          
  24           /**
  25            * @brief  串口发送一字节数据
  26            * @param  DAT:带发送的数据
  27            * @retval 无
  28            */
  29          void UARTSendByte(uint8_t DAT)
  30          {
  31   1              ES  =  0;
  32   1              TI=0;
  33   1              SBUF = DAT;
  34   1              while(TI==0);
  35   1              TI=0;
  36   1              ES = 1;
  37   1      }
  38          
  39           /**
  40            * @brief  串口接收函数
  41            * @param  无
  42            * @retval 返回一个字节
  43            */
  44          
  45          //uint8_t UARTReceiveByte(void)
  46          //{
  47          //      uint8_t DAT;
  48          //      ES  =  0;
  49          //      RI=0;
  50          //      DAT = SBUF;
  51          //      while(RI==0);
  52          //      RI=0;
  53          //      ES = 1;
  54          //      return DAT;
C51 COMPILER V9.60.0.0   USART                                                             08/01/2022 23:31:28 PAGE 2   

  55          //}
  56          
  57           /**
  58            * @brief  串口发送字符串数据
  59            * @param  *DAT：字符串指针
  60            * @retval 无
  61            */
  62          void PrintCom(uint8_t *DAT)
  63          {
  64   1              while(*DAT)
  65   1              {
  66   2                      UARTSendByte(*DAT++);
  67   2              }       
  68   1      }
  69          
  70           /**
  71            * @brief  串口中断函数
  72            * @param  无
  73            * @retval 无
  74            */
  75          void Uart_Isr(void) interrupt 4 using 1
  76          {
  77   1          if (RI)
  78   1          {
  79   2                              RI=0;
  80   2                              RX_BUF[NUM_1]=SBUF;
  81   2                              NUM_1++;
  82   2                              if(NUM_1>=49)
  83   2                              {
  84   3                                      memset(RX_BUF,0,50);
  85   3                                      NUM_1=0;
  86   3                              }
  87   2                              if(NUM_1>=3)
  88   2                              {
  89   3                                      if(RX_BUF[NUM_1]==0xF8&&RX_BUF[NUM_1-1]==0xF8&&RX_BUF[NUM_1-2]==0xF8)
  90   3                                              IAP_CONTR=0x60;         
  91   3                              }               
  92   2                      }
  93   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    201    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     54       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
